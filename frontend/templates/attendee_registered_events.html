<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Events | EventLinker</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='styles/attendee_registered.css') }}" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

  <div class="page-bg"></div>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-left">
      <div class="logo">
        <img src="{{ url_for('static', filename='images/event-linker-logo.png') }}" class="logo-icon">
        <div class="logo-text-wrap">
          <span class="logo-text">EventLinker</span>
          <small class="logo-tagline">Attendee Dashboard</small>
        </div>
      </div>
    </div>

    <nav class="nav-links">
      <a href="{{ url_for('attendee_bp.attendee_homepage') }}"
        class="{% if not from_registered %}active{% endif %}">Dashboard</a>

      <!-- MY EVENTS DROPDOWN -->
      <div class="dropdown">
        <a href="#" id="eventsLink" class="{% if request.endpoint in [
        'attendee_bp.attendee_registered_events',
        'attendee_bp.attendee_my_connections',
        'attendee_bp.attendee_similarity'
        ] %}active{% endif %}">
          My Events ▾
        </a>

        <div class="submenu-vertical" id="eventsSubmenu">
          <a href="{{ url_for('attendee_bp.attendee_registered_events') }}">
            Registered Events
          </a>

          <a href="{{ url_for('attendee_bp.attendee_my_connections') }}">
            My Connections
          </a>

          <a href="{{ url_for('attendee_bp.attendee_similarity') }}">
            Suggested Events
          </a>
        </div>
      </div>

      <a href="{{ url_for('attendee_bp.attendee_connections') }}">
        Notifications
        {% if g.pending_request_count > 0 %}
        <span class="notification-badge">{{ g.pending_request_count }}</span>
        {% endif %}
      </a>

      <div class="profile-dropdown-wrapper">
        <div class="profile-icon-btn" onclick="toggleProfileDropdown()">
          <i class="fa fa-user"></i>
        </div>

        <div id="profileDropdown" class="profile-dropdown-menu">
          <a href="{{ url_for('user_bp.user_profile') }}">
            <i class="fa fa-user"></i> Profile
          </a>
          <a href="{{ url_for('attendee_bp.about_page') }}">
            <i class="fa fa-info-circle"></i> About Us
          </a>
          <a href="{{ url_for('user_bp.logout_user') }}">
            <i class="fa fa-sign-out"></i> Logout
          </a>
        </div>
      </div>
    </nav>
  </header>

  <!-- EVENTS GRID -->
  <section class="event-cards-section">
    <div class="card-container">
      {% if events %}
      {% for event in events %}
      <div class="card" data-event-id="{{ event.event_id }}">
        <img src="{{ event.image_path }}" alt="{{ event.event_title }}" class="card-image">
        <div class="card-content">
          <h3 class="card-title">{{ event.event_title }}</h3>
          <p class="card-meta">
            <i class="fa fa-calendar"></i> {{ event.event_date }} |
            <i class="fa fa-map-marker"></i> {{ event.location }}
          </p>
          <p class="card-description">{{ event.description }}</p>

          <div class="card-buttons">
            <!-- View Button -->
            <a href="{{ url_for('attendee_bp.attendee_event_details', event_id=event.event_id, registered=1) }}">
              <button class="btn-primary">View</button>
            </a>

            <!-- Unregister Button -->
            <form class="unregister-form" method="POST" action="{{ url_for('attendee_bp.unregister_event') }}"
              style="display:inline-block;">
              <input type="hidden" name="event_id" value="{{ event.event_id }}">
              <button type="submit" class="btn-unregister">Leave</button>
            </form>

          </div>

        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}

    <div class="norecord-container">
      <p style="text-align:center; padding:20px; font-size:1.1rem;">
        You have not registered for any events yet.
      </p>
    </div>
    {% endif %}
  </section>

  <footer class="footer">
    <p>© 2025 EventLinker. All rights reserved.</p>
  </footer>

  <script>

    function showModal() {
      const modal = document.getElementById("successModal");
      if (modal) modal.style.display = "flex";
    }

    function closeModal() {
      const modal = document.getElementById("successModal");
      if (modal) modal.style.display = "none";

      const newUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, newUrl);
    }

    // Automatically open modal if flash messages exist
    window.onload = () => {
      const modal = document.getElementById("successModal");
      if (modal) {
        modal.style.display = "flex";
      }
    };

    function toggleProfileDropdown() {
      const menu = document.getElementById("profileDropdown");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    // Close dropdown if clicking outside
    document.addEventListener("click", function (event) {
      const dropdown = document.getElementById("profileDropdown");
      const btn = document.querySelector(".profile-icon-btn");

      if (!dropdown.contains(event.target) && !btn.contains(event.target)) {
        dropdown.style.display = "none";
      }
    });

    document.getElementById('eventsLink').addEventListener('click', function (e) {
      e.preventDefault();
    });

  </script>


  <!-- SUCCESS MODAL (same style as organizer) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div id="successModal" class="modal">
    {% for category, message in messages %}
    <div class="modal-content">
      <h3>{{ message }}</h3>
      <button onclick="closeModal()">OK</button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}
</body>

</html>