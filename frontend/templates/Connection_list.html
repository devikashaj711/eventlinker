<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Connection Requests | Event Linker</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/member_list.css') }}">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="page-bg"></div>

    <!-- NAVBAR (shared look with registration screen) -->
    <header class="navbar">
        <div class="nav-left">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/event-linker-logo.png') }}" class="logo-icon">
                <div class="logo-text-wrap">
                    <span class="logo-text">EventLinker</span>
                    <small class="logo-tagline">Attendee Dashboard</small>
                </div>
                <div class="logo-box">
                </div>
            </div>
        </div>

        <nav class="nav-links">
            <a href="{{ url_for('attendee_bp.attendee_homepage') }}">Dashboard</a>
            <!-- MY EVENTS DROPDOWN -->
      <div class="dropdown">
        <a href="#" id="eventsLink">My Events ▾</a>

        <div class="submenu-vertical" id="eventsSubmenu">
            <a href="{{ url_for('attendee_bp.attendee_registered_events') }}">
                Registered Events
            </a>

            <a href="{{ url_for('attendee_bp.attendee_my_connections') }}">
                My Connections
            </a>

            <a href="{{ url_for('attendee_bp.attendee_similarity') }}">
                Suggested Events
            </a>
        </div>
      </div>

            <!-- <a href="{{ url_for('user_bp.user_profile') }}" class="profile-link">
                <i class="fa fa-user profile-icon"></i>
                <span class="profile-text">Profile</span>
            </a>
            <a href="{{ url_for('attendee_bp.about_page') }}">About Us</a>
            <a href="{{ url_for('user_bp.logout_user') }}" class="logout-link">
                <i class="fa fa-sign-out"></i>
                <span class="profile-text">Logout</span>
            </a> -->
            <a href="{{ url_for('attendee_bp.attendee_connections') }}"
            id="connections"
            class="{% if request.endpoint == 'attendee_bp.attendee_connections' %}active{% endif %}">
            Notifications
            {% if g.pending_request_count > 0 %}
            <span class="notification-badge">{{ g.pending_request_count }}</span>
            {% endif %}
            </a>
            <div class="profile-dropdown-wrapper">
                <div class="profile-icon-btn" onclick="toggleProfileDropdown()">
                    <i class="fa fa-user"></i>
                </div>
            
                <div id="profileDropdown" class="profile-dropdown-menu">
                    <a href="{{ url_for('user_bp.user_profile') }}">
                        <i class="fa fa-user"></i> Profile
                    </a>
                    <a href="{{ url_for('attendee_bp.about_page') }}">
                        <i class="fa fa-info-circle"></i> About Us
                    </a>
                    <a href="{{ url_for('user_bp.logout_user') }}">
                        <i class="fa fa-sign-out"></i> Logout
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="member-container">
            <!-- Back link -->
            <div class="back-link">
                <a href="{{ url_for('attendee_bp.attendee_homepage') }}">
                    <i class="fa fa-arrow-left"></i> Back to dashboard
                </a>
            </div>

            <h1 class="title">Connection Requests</h1>

            {% if requests|length == 0 %}
            <p class="empty-msg">No pending connection requests.</p>
            {% else %}
            <table class="member-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in requests %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ r.first_name }} {{ r.last_name }}</td>
                        <td>
    <!-- Accept Form -->
    <form class="connection-form" action="{{ url_for('attendee_bp.accept_connection') }}" method="POST" style="display:inline-block;">
        <input type="hidden" name="requester_id" value="{{ r.requester_id }}">
        <button class="connect-btn" type="submit" {% if r.status_id==2 %} disabled {% endif %}>
            {% if r.status_id == 1 %}
            Accept
            {% else %}
            Accepted
            {% endif %}
        </button>
    </form>

    <!-- Decline Form -->
    <form class="connection-form decline-form" action="{{ url_for('attendee_bp.decline_connection') }}" method="POST" style="display:inline-block; margin-left: 5px;">
        <input type="hidden" name="requester_id" value="{{ r.requester_id }}">
        <button class="connect-btn decline-btn" type="submit">
            Decline
        </button>
    </form>
</td>

                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <p>© 2025 EventLinker. All rights reserved.</p>
    </footer>

    <!-- SCRIPT: Update button text and disable on click -->
    <script>
    document.querySelectorAll('.connection-form').forEach(form => {
        form.addEventListener('submit', function (e) {
            e.preventDefault(); // prevent normal form submission

            const button = form.querySelector('button');
            const isDecline = form.classList.contains('decline-form');

            button.textContent = isDecline ? 'Declined' : 'Accepted';
            button.disabled = true;

            // Disable the other button in the same row
            if (!isDecline) {
                const declineBtn = form.parentElement.querySelector('.decline-btn');
                if (declineBtn) declineBtn.disabled = true;
            } else {
                const acceptBtn = form.parentElement.querySelector('.connect-btn:not(.decline-btn)');
                if (acceptBtn) acceptBtn.disabled = true;
            }

            const formData = new FormData(form);
            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                // Optionally handle server response
            })
            .catch(error => {
                console.error('Error:', error);
                button.disabled = false;
                button.textContent = isDecline ? 'Decline' : 'Accept';
            });
        });
    });
    function toggleProfileDropdown() {
        const menu = document.getElementById("profileDropdown");
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    // Close dropdown if clicking outside
    document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("profileDropdown");
        const btn = document.querySelector(".profile-icon-btn");

        if (!dropdown.contains(event.target) && !btn.contains(event.target)) {
            dropdown.style.display = "none";
        }
    });
    document.getElementById('eventsLink').addEventListener('click', function (e) {
    e.preventDefault();
    });
</script>


</body>

</html>