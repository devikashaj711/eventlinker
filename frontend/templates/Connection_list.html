<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Connection Requests | Event Linker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/organizer_homepage.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/member_list.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
</head>

<body style="color: #fff; font-family: Poppins, sans-serif;">

   <header class="navbar">
    <div class="logo">
      <span class="logo-text">Event Linker</span>
      <small class="logo-tagline">An Integrated Event Networking Platform</small>
    </div>

    <nav class="nav-links">
  <a href="#" onclick="openAboutModal()">About</a>
<a href="{{ url_for('attendee_bp.attendee_connections') }}" id="connections">Connections</a>
  <a href="#" >Similarity</a>
  <a href="#">Attendee</a>

  <!-- Events dropdown -->
  <div class="dropdown">
    <a href="#" id="eventsLink">My Events ▾</a>
    <div id="eventsSubmenu" class="submenu-vertical">
<a href="{{ url_for('attendee_bp.attendee_registered_events') }}">Registered</a>

    </div>
  </div>

  <a href="{{ url_for('user_bp.user_profile') }}" class="profile-link">
    <i class="fa fa-user profile-icon"></i>
    <span class="profile-text">Profile</span>
  </a>
  <a href="{{ url_for('user_bp.logout_user') }}">
    <i class="fa fa-user fa fa-sign-out"></i>
    <span class="profile-text">Logout</span>
  </a>
</nav>

  </header>

    <main>
        <div class="member-container">
            <h1 class="title">Connection Requests</h1>

            {% if requests|length == 0 %}
                <p class="empty-msg">No pending connection requests.</p>
            {% else %}
                <table class="member-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in requests %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ r.first_name }} {{ r.last_name }}</td>
                            <td>
                                <form class="connection-form" action="{{ url_for('attendee_bp.accept_connection') }}" method="POST">
                                    <input type="hidden" name="requester_id" value="{{ r.requester_id }}">
                                    <button class="connect-btn" type="submit"
                                        {% if r.status_id == 2 %} disabled {% endif %}>
                                        {% if r.status_id == 1 %}
                                            Accept
                                        {% else %}
                                            Accepted
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}

            <a href="{{ url_for('attendee_bp.attendee_homepage') }}" class="back-btn">Back to Homepage</a>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <p>© 2025 EventLinker. All rights reserved.</p>
    </footer>

    <!-- SCRIPT: Update button text and disable on click -->
    <script>
        document.querySelectorAll('.connection-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault(); // prevent normal form submission

                const button = form.querySelector('button.connect-btn');
                button.textContent = 'Accepted'; // update text
                button.disabled = true; // disable button

                // Send form data via fetch (AJAX)
                const formData = new FormData(form);
                fetch(form.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    // Optionally handle server response
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Revert if error
                    button.disabled = false;
                    button.textContent = 'Accept';
                });
            });
        });
    </script>

</body>
</html>
