<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In | EventLinker</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='styles/login.css') }}">

  <!-- Fonts / Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<body>

  <div class="login-container">

    <!-- LEFT COLUMN -->
    <div class="left-side">

      <!-- FLASH MESSAGES (EventLinker Style) -->
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
      <div class="flash-wrapper">
        {% for category, message in messages %}
        <div class="flash-box {{ category }}">
          <span class="flash-text">{{ message }}</span>
        </div>
        {% endfor %}
      </div>
      {% endif %}
      {% endwith %}


      <!-- LOGO -->
      <div class="logo-box">
        <img src="{{ url_for('static', filename='images/event-linker-logo.png') }}" class="logo-icon">
        <span class="logo-text">EventLinker</span>
      </div>

      <h1 class="welcome-title">Hello,<br>Welcome Back</h1>
      <p class="welcome-subtitle">Hey, welcome back to your special place</p>

      <!-- LOGIN FORM -->
      <form action="{{ url_for('user_bp.login_user') }}" method="POST" class="login-form">

        <div class="form-group">
          <input type="email" name="email" placeholder="abc@gmail.com" required>
        </div>

        <div class="form-group">
          <input type="password" name="password" placeholder="••••••••••••" required>
        </div>

        <div class="options-row">
          <label class="remember-me">
            <input type="checkbox">
            <span>Remember me</span>
          </label>

          <a href="javascript:void(0)" onclick="openEmailModal()" class="forgot-link">Forgot Password?</a>


        </div>

        <button type="submit" class="btn-primary">Sign In</button>

      </form>

      <p class="signup-text">
        Don’t have an account?
        <a href="/register" class="signup-link">Sign Up</a>
      </p>

    </div>

    <!-- RIGHT PURPLE CARD -->
    <div class="right-side">
      <img src="{{ url_for('static', filename='images/eventlinker-login3.png') }}" class="illustration-clean"
        alt="Event Illustration">
    </div>

  </div>

  <!-- FORGOT PASSWORD POPUP -->
  <!-- RESET PASSWORD POPUP -->
  <!-- RESET STEP 1: ENTER EMAIL -->
  <div id="emailModal" class="modal-background" style="display:none;">
    <div class="modal-box">
      <h2 class="modal-title">Reset Password</h2>
      <p class="modal-subtitle">Enter your registered email</p>

      <form action="{{ url_for('user_bp.send_reset_otp') }}" method="POST">
        <input type="email" name="email" class="modal-input" placeholder="Enter your email" required>

        <button type="submit" class="modal-btn">Send OTP</button>
      </form>

      <button class="modal-close" onclick="closeEmailModal()">Close</button>
    </div>
  </div>

  <!-- RESET STEP 2: VERIFY OTP -->
  <div id="otpModal" class="modal-background" style="display:none;">
    <div class="modal-box">
      <h2 class="modal-title">Verify OTP</h2>
      <p class="modal-subtitle">Enter the 6-digit OTP sent to your email</p>

      <form action="{{ url_for('user_bp.verify_reset_otp') }}" method="POST">
        <input type="text" name="otp" class="modal-input" placeholder="Enter OTP" required>

        <button type="submit" class="modal-btn">Verify OTP</button>
      </form>

      <button class="modal-close" onclick="closeOtpModal()">Close</button>
    </div>
  </div>

  <!-- RESET STEP 3: NEW PASSWORD -->
  <div id="passwordModal" class="modal-background" style="display:none;">
    <div class="modal-box">

      <h2 class="modal-title">Set New Password</h2>
      <p class="modal-subtitle">Enter your new password</p>

      <form action="{{ url_for('user_bp.direct_reset_password') }}" method="POST">
        <input type="password" name="password" class="modal-input" placeholder="New Password" required>

        <input type="password" name="confirm_password" class="modal-input" placeholder="Confirm Password" required>

        <button type="submit" class="modal-btn">Update Password</button>
      </form>

      <button class="modal-close" onclick="closePasswordModal()">Close</button>
    </div>
  </div>



  <script>
    function openEmailModal() {
      document.getElementById("emailModal").style.display = "flex";
    }
    function closeEmailModal() {
      document.getElementById("emailModal").style.display = "none";
    }

    function openOtpModal() {
      document.getElementById("otpModal").style.display = "flex";
    }
    function closeOtpModal() {
      document.getElementById("otpModal").style.display = "none";
    }

    function openPasswordModal() {
      document.getElementById("passwordModal").style.display = "flex";
    }
    function closePasswordModal() {
      document.getElementById("passwordModal").style.display = "none";
    }

    // Auto-hide flash messages after 5 seconds
    setTimeout(() => {
      const flashMessages = document.querySelectorAll('.flash-box');
      flashMessages.forEach(msg => {
        msg.classList.add('fade-out');
      });
    }, 5000);

  </script>

  <!-- AUTO OPEN MODALS FROM BACKEND -->
  {% if session.get('open_otp_modal') %}
  <script> openOtpModal(); </script>
  {% set _ = session.pop('open_otp_modal') %}
  {% endif %}

  {% if session.get('open_password_modal') %}
  <script> openPasswordModal(); </script>
  {% set _ = session.pop('open_password_modal') %}
  {% endif %}


</body>

</html>